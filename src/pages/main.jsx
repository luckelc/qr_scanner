  'use client';
  import React, {useState, useEffect } from 'react';
  import Head from 'next/head'
  import questions from "@/questions.json";
  import styles from '@/styles/index.module.css'
  import QuestionRow from '@/components/QuestionRow';
  import ModuleComponent from '@/components/Module';
  import Html5QrcodePlugin from '@/components/Html5QrcodePlugin';

  export default function QrScannerHomePage() {
    const [isModuleVisible, setIsModuleVisible] = useState(false);
    const [isScannerVisible, setIsScannerVisible] = useState(false);
    const [selectedQuestion, setSelectedQuestion] = useState(null);

    // Step 1: Initialize questionsData with data from localStorage on startup
    const [questionsData, setquestionsData] = useState([]);

    useEffect(() => {
      const storedData = localStorage.getItem('questionsData');
      const initialData = storedData ? JSON.parse(storedData) : questions.questions;
      setquestionsData(initialData);
    }, []);

    const [questionBlock, setQuestionBlock] = useState([]);
    useEffect(() => {
      if (questionsData.length > 0) {
        let temp = []
        for (let i = 0; i < questionsData.length; i++) {
          const question = getQuestionHandler(i);
          const questionComponent = (
            <QuestionRow
              key={question.id} // Don't forget to add a unique key
              onClick={toggleModuleVisibilityText}
              question={question}
            />
          );
          temp.push(questionComponent)
        }
        setQuestionBlock(temp)
      }
    }, [questionsData]);

    const getInputFromScan = (scanData) => {
      questionsData.forEach(question => {
        if(question.id == scanData){
          question.found = true;
        }
      });
    };

    function getQuestionHandler(questionIndex) {
      return questionsData[questionIndex]
    }

    const toggleModuleVisibilityText = (selectedQuestionData) => {
      setIsModuleVisible(true);
      setSelectedQuestion(selectedQuestionData); // Store the selected question data
    };

    return (
      <>
        <Head>
          <title>Qr Scanner</title>
          <meta name="description" content="Generated by create next app" />
          <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
        <main className={styles.main}>

          {isScannerVisible? (

            <div className="scanner">
              <Html5QrcodePlugin
                  resultFromScan={getInputFromScan}
                  removeScanner={setIsScannerVisible}
              />
            </div>

          ) : (

            <div className="questions">

              {isModuleVisible? (<ModuleComponent question={selectedQuestion} onClick={setIsModuleVisible}/>) : ''}
              <h1 className={styles.h1}>QR Scanning Code</h1>
              
              {questionBlock}

              <div className={styles.nav}>
                <div className={styles.navGroup}>
                  <button onClick={setIsScannerVisible} className={styles.scan}>SCAN</button>
                  <button className={styles.give_up}>GIVE UP</button>
                </div>
              </div>
            </div>
          )}

          
        </main>
      </>
    )
  }
